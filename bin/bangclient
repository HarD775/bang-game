#!/bin/sh
#
# $Id$
#
# Command line launcher for the Bang! development client

BANG_HOME=`dirname $0`
BANG_HOME=`cd $BANG_HOME/.. ; pwd`
ARGS="localhost 47624"
JARGS="-Dresource_dir=$BANG_HOME/rsrc -Dno_unpack_resources=true"

# parse our arguments
while [ ! -z "$1" ]; do
    case "$1" in
        -go=*)
            GO=`echo $1 | sed 's:-go=::g'`;
            JARGS="$JARGS -Dgo=$GO";
            ;;
        
        -test=*)
            BOARD=`echo $1 | sed 's:-test=::g'`;
            JARGS="$JARGS -Dboard=\"$BOARD\" -Dtest=true";
            ;;
        
        -test)
            JARGS="$JARGS -Dtest=true";
            ;;
        
        -tutorial)
            JARGS="$JARGS -Dtutorial=test";
            ;;
        
        -tutorial=*)
            TUTORIAL=`echo $1 | sed 's:-tutorial=::g'`;
            JARGS="$JARGS -Dtutorial=$TUTORIAL";
            ;;
        
        -build)
            ant
            if [ $? != 0 ]; then
                echo "Compilation failed."
                exit 255
            fi
            ;;

        -yjp)
            export LD_LIBRARY_PATH=$HOME/lib/yjp-5.1.1/bin/linux-x86-32
            JARGS="-agentlib:yjpagent $JARGS"
            JARGS="-Dprofiling=true $JARGS"
            ;;

        -D*)
            JARGS="$JARGS $1"
            ;;

        *)
            ARGS="$ARGS $1"
            ;;
    esac
    shift
done

# load resources directly from the rsrc directory
export CLASSPATH=$BANG_HOME
CLASS=com.threerings.bang.client.BangApp
$BANG_HOME/bin/runjava -- -Dno_log_redir=true $JARGS $CLASS $ARGS

# restore key repeat, which LWJGL borks if the game crashes
xset r on
